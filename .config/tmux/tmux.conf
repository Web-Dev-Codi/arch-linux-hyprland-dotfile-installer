# ╔══════════════════════════════════════════════════════════╗
# ║  Tmux Config — Ghostty + Hyprland + Arch Linux          ║
# ║  Optimized for GPU-accelerated terminal, low overhead    ║
# ╚══════════════════════════════════════════════════════════╝

# ── Terminal & Performance ────────────────────────────────
set -g  default-terminal   "tmux-256color"
set -ag terminal-overrides  ",ghostty:RGB,ghostty:Tc"
set -ag terminal-overrides  ",ghostty:Smulx=\E[4::%p1%dm"   # undercurl
set -ag terminal-overrides  ",ghostty:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m"
set -g  escape-time         0          # instant ESC for Neovim
set -g  repeat-time         300
set -g  history-limit       10000
set -g  focus-events        on
set -g  set-clipboard       on
set -g  mouse               on

# ── Indexing ──────────────────────────────────────────────
set  -g base-index       1
setw -g pane-base-index  1
set  -g renumber-windows on

# ── Prefix ────────────────────────────────────────────────
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# ── Vi Mode ───────────────────────────────────────────────
setw -g mode-keys vi
bind -T copy-mode-vi v   send -X begin-selection
bind -T copy-mode-vi C-v send -X rectangle-toggle
bind -T copy-mode-vi y   send -X copy-pipe-and-cancel "wl-copy"

# ── Navigation ────────────────────────────────────────────
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

bind -r H resize-pane -L 4
bind -r J resize-pane -D 4
bind -r K resize-pane -U 4
bind -r L resize-pane -R 4

# ── Splits & Windows (inherit CWD) ───────────────────────
bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"
bind c new-window   -c "#{pane_current_path}"

# Tab-style window switching
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-h previous-window
bind -n M-l next-window

# ── Popup Displays (centered) ───────────────────────────────
# Prefix+p → popup terminal in current working directory
bind p display-popup -E -x C -y C -w 85% -h 80% \
    -d "#{pane_current_path}" \
    -T " 󰆍 Terminal " \
    -S "fg=#89b4fa" \
    "$SHELL"

# Prefix+o → popup Ollama dev chat
bind o display-popup -E -x C -y C -w 85% -h 80% \
    -d "#{pane_current_path}" \
    -T "  Ollama Chat " \
    -S "fg=#a6e3a1" \
    "$HOME/.local/bin/tmux-ollama-chat"

# ── Utility ───────────────────────────────────────────────
bind r source-file ~/.config/tmux/tmux.conf \; display " Config reloaded"
bind x kill-pane
bind X kill-window

# ── Pane Borders ──────────────────────────────────────────
set -g pane-border-style        "fg=#313244"
set -g pane-active-border-style "fg=#89b4fa"
set -g popup-border-style       "fg=#89b4fa"

# ══════════════════════════════════════════════════════════
#  STATUS BAR
# ══════════════════════════════════════════════════════════
set -g status             on
set -g status-position    bottom
set -g status-interval    5           # refresh every 5s (git, cwd)
set -g status-justify     left
set -g status-style       "bg=#11111b,fg=#cdd6f4"

# ── Left: Session indicator ──────────────────────────────
set -g status-left-length 30
set -g status-left "\
#[bg=#89b4fa,fg=#11111b,bold]  #S \
#[bg=#11111b,fg=#89b4fa,nobold]"

# ── Window / Tab List ────────────────────────────────────
# Inactive tab
set -g window-status-format "\
#[bg=#181825,fg=#11111b]\
#[bg=#181825,fg=#6c7086] #I  #W \
#[bg=#11111b,fg=#181825]"

# Active tab
set -g window-status-current-format "\
#[bg=#89b4fa,fg=#11111b]\
#[bg=#89b4fa,fg=#11111b,bold] #I  #W \
#[bg=#11111b,fg=#89b4fa]"

set -g window-status-separator ""

# ── Right: Git + CWD + Command ───────────────────────────
set -g status-right-length 120
set -g status-right "\
#(~/.local/bin/tmux-git-status '#{pane_current_path}') \
#[bg=#181825,fg=#11111b]\
#[bg=#181825,fg=#a6adc8] 󰉋 #{b:pane_current_path} \
#[bg=#313244,fg=#181825]\
#[bg=#313244,fg=#cdd6f4]  #{pane_current_command} \
#[bg=#11111b,fg=#313244]"

# ── Message Style ────────────────────────────────────────
set -g message-style        "bg=#313244,fg=#cdd6f4"
set -g message-command-style "bg=#313244,fg=#cdd6f4"
set -g mode-style           "bg=#45475a,fg=#cdd6f4"
